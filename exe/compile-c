#!/bin/sh -e

root="$PWD"
target_dir=tmp
c=src/c-precompiled
optimization=3

# minimal diagnostics: keep only clearly useful ones
warnings="-Wall -Wfatal-errors"

# standard + posix feature test. avoid compiler- or distro-specific extras.
gcc_options="-std=c17 -pedantic-errors -D_POSIX_C_SOURCE=200809L -D_FILE_OFFSET_BITS=64 \
  $warnings -funsigned-char -fno-common -fno-math-errno -fPIC -O$optimization \
  -pthread -I$c"

compile_test_sph_sc_lib() {
  gcc $gcc_options "$c/test/spline-path.c" -o "$target_dir/test-spline-path" -lm
  gcc $gcc_options "$c/test/quicksort.c" -o "$target_dir/test-quicksort"
  gcc $gcc_options "$c/test/random.c" -o "$target_dir/test-random"
  gcc $gcc_options "$c/test/set.c" -o "$target_dir/test-set"
  gcc $gcc_options "$c/test/hashtable.c" -o "$target_dir/test-hashtable"
  gcc $gcc_options "$c/test/thread-pool.c" -o "$target_dir/test-thread-pool"
  gcc $gcc_options "$c/test/ikv.c" -o "$target_dir/test-ikv"
  gcc $gcc_options "$c/test/other.c" -o "$target_dir/test-other"
}

mkdir -p "$target_dir" &&
compile_test_sph_sc_lib
